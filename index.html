<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="version" content="2.0.4">
    <meta name="description" content="ef-sin Inventur v2.0.4 - Icon-Picker + Dark Mode + Men√º">
    <title>ef-sin Inventur v2.0.4</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="dark-mode.css">
    <link rel="stylesheet" href="icon-picker.css">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="icon.svg">
</head>
<body>

<!-- ================= HEADER ================= -->
<header class="app-header">
    <div class="header-left">
        <h1>üì¶ ef-sin Inventur <span class="version">v2.0.4</span></h1>
    </div>
    <div class="header-right">
        <button id="themeToggle" class="btn-icon" title="Dark Mode umschalten">
            <span id="themeIcon">üåô</span>
        </button>
        <button id="syncButton" class="btn-icon" title="GitHub Sync">üîÑ</button>
        <button id="menuButton" class="btn-icon" title="Men√º">‚ò∞</button>
    </div>
</header>

<!-- ================= KATEGORIE TABS ================= -->
<nav class="category-tabs" id="categoryTabs"></nav>

<!-- ================= ACTION BUTTONS ================= -->
<div class="action-buttons">
    <button id="addNormalButton" class="btn-primary">
        <span class="btn-icon">+</span>
        <span class="btn-text">Artikel</span>
    </button>
    <button id="addQuickButton" class="btn-success">
        <span class="btn-icon">‚ö°</span>
        <span class="btn-text">Quick Add</span>
    </button>
</div>

<!-- ================= SUCHE ================= -->
<div class="search-container">
    <input type="text" id="searchInput" placeholder="üîç Suchen...">
</div>

<!-- ================= ARTIKEL LISTE ================= -->
<main class="items-container" id="itemsContainer"></main>

<!-- ================= LOADING ================= -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <p>Lade...</p>
</div>

<!-- ================= ARTIKEL MODAL ================= -->
<div class="modal" id="addModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Artikel</h2>
            <button class="btn-close" onclick="app.closeModal()">√ó</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="itemCategory">Kategorie *</label>
                <select id="itemCategory" required></select>
            </div>
            <div class="form-group">
                <label for="itemName">Name *</label>
                <input type="text" id="itemName" required>
            </div>
            <div class="form-group">
                <label for="itemSKU">SKU</label>
                <input type="text" id="itemSKU">
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="itemStock">Bestand *</label>
                    <input type="number" id="itemStock" required>
                </div>
                <div class="form-group">
                    <label for="itemUnit">Einheit</label>
                    <select id="itemUnit">
                        <option>St√ºck</option>
                        <option>Meter</option>
                        <option>Kilogramm</option>
                        <option>Liter</option>
                        <option>Paket</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="itemMin">Min</label>
                    <input type="number" id="itemMin">
                </div>
                <div class="form-group">
                    <label for="itemMax">Max</label>
                    <input type="number" id="itemMax">
                </div>
                <div class="form-group">
                    <label for="itemPrice">Preis (‚Ç¨)</label>
                    <input type="number" step="0.01" id="itemPrice">
                </div>
            </div>
            <div class="form-group">
                <label for="itemLocation">Standort</label>
                <input type="text" id="itemLocation">
            </div>
            <div class="form-group">
                <label for="itemPhoto">Foto</label>
                <input type="file" id="itemPhoto" accept="image/*" capture="environment">
                <div id="photoPreview" style="margin-top: 10px;"></div>
            </div>
            <div class="form-group">
                <label for="itemNotes">Notizen</label>
                <textarea id="itemNotes" rows="3"></textarea>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="app.closeModal()">Abbrechen</button>
            <button class="btn-primary" onclick="app.saveItem()">Speichern</button>
        </div>
    </div>
</div>

<!-- ================= QUICK ADD MODAL ================= -->
<div class="modal" id="quickAddModal">
    <div class="modal-content quick-add">
        <div class="modal-header">
            <h2>‚ö° Schnelleingabe</h2>
            <button class="btn-close" onclick="quickAdd.close()">√ó</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="quickCategory">Kategorie</label>
                <select id="quickCategory"></select>
            </div>
            <div class="form-group">
                <label for="quickSKU">SKU</label>
                <input type="text" id="quickSKU">
            </div>
            <div class="form-group">
                <label for="quickName">Name *</label>
                <input type="text" id="quickName" required>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="quickStock">Anzahl *</label>
                    <input type="number" id="quickStock" required>
                </div>
                <div class="form-group">
                    <label for="quickPrice">Preis</label>
                    <input type="number" step="0.01" id="quickPrice">
                </div>
            </div>
            <div class="form-group">
                <label for="quickLocation">Standort</label>
                <input type="text" id="quickLocation">
            </div>
            <div class="form-group">
                <label for="quickPhoto">Foto</label>
                <input type="file" id="quickPhoto" accept="image/*" capture="environment">
                <div id="quickPhotoPreview" style="margin-top: 10px;"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-primary" onclick="quickAdd.save()">Speichern</button>
        </div>
    </div>
</div>

<!-- ================= KATEGORIE EDIT MODAL ================= -->
<div class="modal" id="categoryEditModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="categoryModalTitle">Kategorie</h2>
            <button class="btn-close" onclick="closeCategoryEditModal()">√ó</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="catName">Name *</label>
                <input type="text" id="catName" required>
            </div>
            <div class="form-group">
                <label>Icon *</label>
                <div class="icon-input-wrapper">
                    <div class="icon-preview" id="catIconPreview">üì¶</div>
                    <div class="icon-input-field">
                        <input type="text" id="catIcon" placeholder="üì¶" maxlength="4" value="üì¶">
                        <small>Emoji direkt eingeben oder ausw√§hlen</small>
                    </div>
                    <button type="button" class="icon-select-btn" id="openIconPickerBtn">
                        Icon ausw√§hlen
                    </button>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeCategoryEditModal()">Abbrechen</button>
            <button class="btn-primary" onclick="saveCategory()">Speichern</button>
        </div>
    </div>
</div>

<!-- ================= KATEGORIE MANAGEMENT MODAL ================= -->
<div class="modal" id="categoryManagementModal">
    <div class="modal-content" style="max-width: 700px;">
        <div class="modal-header">
            <h2>üìÅ Kategorien verwalten</h2>
            <button class="btn-close" onclick="closeCategoryManagement()">√ó</button>
        </div>
        <div class="modal-body">
            <button class="btn-primary" style="width: 100%; margin-bottom: 20px;" onclick="openNewCategoryModal()">
                + Neue Kategorie
            </button>
            <div id="categoryListContainer"></div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeCategoryManagement()">Schlie√üen</button>
        </div>
    </div>
</div>

<!-- ================= GITHUB SETTINGS MODAL ================= -->
<div class="modal" id="githubSettingsModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>‚öôÔ∏è GitHub Einstellungen</h2>
            <button class="btn-close" onclick="closeGitHubSettings()">√ó</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="ghToken">GitHub Token</label>
                <input type="password" id="ghToken" placeholder="ghp_...">
                <small>Personal Access Token mit repo-Rechten</small>
            </div>
            <div class="form-group">
                <label for="ghUsername">Username</label>
                <input type="text" id="ghUsername" placeholder="username">
            </div>
            <div class="form-group">
                <label for="ghRepo">Repository</label>
                <input type="text" id="ghRepo" placeholder="inventur-v2">
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="ghAutoSync">
                    Auto-Sync aktivieren
                </label>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeGitHubSettings()">Abbrechen</button>
            <button class="btn-primary" onclick="saveGitHubSettings()">Speichern</button>
        </div>
    </div>
</div>

<!-- ================= ICON PICKER MODAL ================= -->
<div id="iconPickerModal" class="modal icon-picker-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üé® Icon ausw√§hlen</h2>
            <button class="btn-close" onclick="window.iconPicker && window.iconPicker.close()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="icon-picker-search">
                <input type="text" id="iconSearchInput" placeholder="üîç Icon suchen..." autocomplete="off">
            </div>
            <div class="icon-picker-tabs" id="iconPickerTabs"></div>
            <div class="icon-picker-grid" id="iconPickerGrid"></div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="window.iconPicker && window.iconPicker.close()">Abbrechen</button>
        </div>
    </div>
</div>

<!-- ================= MEN√ú ================= -->
<div class="menu-overlay" id="menuOverlay"></div>
<aside class="menu-sidebar" id="menuSidebar">
    <div class="menu-header">
        <h2>Men√º</h2>
        <button class="btn-close" id="menuCloseBtn">√ó</button>
    </div>
    <div class="menu-content">
        <button class="menu-item" id="menuCategoriesBtn">
            <span class="menu-icon">üìÅ</span>
            <span class="menu-text">Kategorien verwalten</span>
        </button>
        <button class="menu-item" id="menuExportBtn">
            <span class="menu-icon">üíæ</span>
            <span class="menu-text">Daten exportieren</span>
        </button>
        <button class="menu-item" id="menuImportBtn">
            <span class="menu-icon">üì•</span>
            <span class="menu-text">Daten importieren</span>
        </button>
        <button class="menu-item" id="menuGitHubBtn">
            <span class="menu-icon">‚öôÔ∏è</span>
            <span class="menu-text">GitHub Einstellungen</span>
        </button>
        <button class="menu-item" id="menuSyncBtn">
            <span class="menu-icon">üîÑ</span>
            <span class="menu-text">Jetzt synchronisieren</span>
        </button>
    </div>
</aside>

<!-- ================= SCRIPTS ================= -->
<script src="src/managers/CategoryManager.js"></script>
<script src="src/managers/ImageManager.js"></script>
<script src="src/managers/MultiFileGitHubSync.js"></script>
<script src="src/components/QuickAdd.js"></script>
<script src="src/components/IconPicker.js"></script>
<script src="app.js"></script>

<!-- ================= INITIALIZATION & EVENT HANDLERS ================= -->
<script>
console.log('üöÄ ef-sin Inventur v2.0.4 initializing...');

// =============================================================================
// GLOBALE FUNKTIONEN F√úR MODALS (f√ºr onclick-Handler)
// =============================================================================

function showCategoryManagement() {
    console.log('üìÅ Kategorie-Management √∂ffnen');
    document.getElementById('categoryManagementModal').classList.add('active');
    if (window.app && window.app.loadCategoryList) {
        window.app.loadCategoryList();
    }
}

function closeCategoryManagement() {
    console.log('‚úñÔ∏è Kategorie-Management schlie√üen');
    document.getElementById('categoryManagementModal').classList.remove('active');
}

function openNewCategoryModal() {
    console.log('‚ûï Neue Kategorie Modal √∂ffnen');
    document.getElementById('categoryModalTitle').textContent = 'Neue Kategorie';
    document.getElementById('catName').value = '';
    document.getElementById('catIcon').value = 'üì¶';
    document.getElementById('catIconPreview').textContent = 'üì¶';
    document.getElementById('categoryEditModal').classList.add('active');
}

function closeCategoryEditModal() {
    console.log('‚úñÔ∏è Kategorie-Edit Modal schlie√üen');
    document.getElementById('categoryEditModal').classList.remove('active');
}

function saveCategory() {
    console.log('üíæ Kategorie speichern');
    const name = document.getElementById('catName').value.trim();
    const icon = document.getElementById('catIcon').value.trim();
    
    if (!name) {
        alert('Bitte gebe einen Namen ein!');
        return;
    }
    
    if (window.categoryManager) {
        const category = { name, icon: icon || 'üì¶' };
        window.categoryManager.addCategory(category);
        closeCategoryEditModal();
        if (window.app && window.app.loadCategoryList) {
            window.app.loadCategoryList();
        }
        if (window.app && window.app.showToast) {
            window.app.showToast(`Kategorie "${name}" erstellt!`, 'success');
        }
    }
}

function exportData() {
    console.log('üíæ Daten exportieren');
    if (window.app && window.app.exportData) {
        window.app.exportData();
    } else {
        alert('Export-Funktion wird geladen...');
    }
}

function importData() {
    console.log('üì• Daten importieren');
    if (window.app && window.app.importData) {
        window.app.importData();
    } else {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.click();
    }
}

function showGitHubSettings() {
    console.log('‚öôÔ∏è GitHub Settings √∂ffnen');
    document.getElementById('githubSettingsModal').classList.add('active');
}

function closeGitHubSettings() {
    console.log('‚úñÔ∏è GitHub Settings schlie√üen');
    document.getElementById('githubSettingsModal').classList.remove('active');
}

function saveGitHubSettings() {
    console.log('üíæ GitHub Settings speichern');
    const token = document.getElementById('ghToken').value;
    const username = document.getElementById('ghUsername').value;
    const repo = document.getElementById('ghRepo').value;
    const autoSync = document.getElementById('ghAutoSync').checked;
    
    localStorage.setItem('github_token', token);
    localStorage.setItem('github_username', username);
    localStorage.setItem('github_repo', repo);
    localStorage.setItem('github_autosync', autoSync);
    
    closeGitHubSettings();
    alert('GitHub Einstellungen gespeichert!');
}

function manualSync() {
    console.log('üîÑ Manueller Sync');
    if (window.githubSync && window.githubSync.sync) {
        window.githubSync.sync();
    } else {
        alert('Sync wird noch initialisiert...');
    }
}

// =============================================================================
// DOM CONTENT LOADED
// =============================================================================

document.addEventListener('DOMContentLoaded', function() {
    console.log('‚úÖ DOM loaded');
    
    // =========================================================================
    // MEN√ú EVENT HANDLERS
    // =========================================================================
    const menuButton = document.getElementById('menuButton');
    const menuSidebar = document.getElementById('menuSidebar');
    const menuOverlay = document.getElementById('menuOverlay');
    const menuCloseBtn = document.getElementById('menuCloseBtn');
    
    function closeMenu() {
        console.log('‚úñÔ∏è Men√º schlie√üen');
        if (menuSidebar) menuSidebar.classList.remove('active');
        if (menuOverlay) menuOverlay.classList.remove('active');
    }
    
    if (menuButton) {
        menuButton.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('üìÇ Men√º √∂ffnen');
            if (menuSidebar) menuSidebar.classList.add('active');
            if (menuOverlay) menuOverlay.classList.add('active');
        });
    }
    
    if (menuCloseBtn) {
        menuCloseBtn.addEventListener('click', closeMenu);
    }
    
    if (menuOverlay) {
        menuOverlay.addEventListener('click', closeMenu);
    }
    
    // Men√º-Items
    const menuCategoriesBtn = document.getElementById('menuCategoriesBtn');
    const menuExportBtn = document.getElementById('menuExportBtn');
    const menuImportBtn = document.getElementById('menuImportBtn');
    const menuGitHubBtn = document.getElementById('menuGitHubBtn');
    const menuSyncBtn = document.getElementById('menuSyncBtn');
    
    if (menuCategoriesBtn) {
        menuCategoriesBtn.addEventListener('click', function() {
            showCategoryManagement();
            closeMenu();
        });
    }
    
    if (menuExportBtn) {
        menuExportBtn.addEventListener('click', function() {
            exportData();
            closeMenu();
        });
    }
    
    if (menuImportBtn) {
        menuImportBtn.addEventListener('click', function() {
            importData();
            closeMenu();
        });
    }
    
    if (menuGitHubBtn) {
        menuGitHubBtn.addEventListener('click', function() {
            showGitHubSettings();
            closeMenu();
        });
    }
    
    if (menuSyncBtn) {
        menuSyncBtn.addEventListener('click', function() {
            manualSync();
            closeMenu();
        });
    }
    
    console.log('‚úÖ Men√º Event Handlers installiert');
    
    // =========================================================================
    // DARK MODE
    // =========================================================================
    const html = document.documentElement;
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    
    if (themeToggle && themeIcon) {
        const savedTheme = localStorage.getItem('theme');
        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const initialTheme = savedTheme || (systemDark ? 'dark' : 'light');
        
        html.setAttribute('data-theme', initialTheme);
        themeIcon.textContent = initialTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        
        themeToggle.addEventListener('click', function() {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            themeIcon.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            
            console.log(`üé® Theme: ${newTheme}`);
        });
        
        console.log('‚úÖ Dark Mode installiert');
    }
    
    // =========================================================================
    // ICON PICKER
    // =========================================================================
    if (typeof IconPicker !== 'undefined') {
        window.iconPicker = new IconPicker();
        console.log('‚úÖ Icon Picker initialized');
        
        const catIconInput = document.getElementById('catIcon');
        const catIconPreview = document.getElementById('catIconPreview');
        const openPickerBtn = document.getElementById('openIconPickerBtn');
        
        if (catIconInput && catIconPreview) {
            catIconInput.addEventListener('input', function() {
                const icon = this.value.trim();
                if (icon) {
                    catIconPreview.textContent = icon;
                }
            });
            
            if (catIconInput.value) {
                catIconPreview.textContent = catIconInput.value;
            }
        }
        
        if (openPickerBtn) {
            openPickerBtn.addEventListener('click', function(e) {
                e.preventDefault();
                const currentIcon = catIconInput.value || 'üì¶';
                
                window.iconPicker.open(currentIcon, function(selectedIcon) {
                    catIconInput.value = selectedIcon;
                    catIconPreview.textContent = selectedIcon;
                    console.log('‚úÖ Icon selected:', selectedIcon);
                });
            });
        }
        
        const searchInput = document.getElementById('iconSearchInput');
        if (searchInput) {
            let searchTimeout;
            searchInput.addEventListener('input', function(e) {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const query = e.target.value.trim();
                    if (query.length > 0) {
                        const results = window.iconPicker.search(query);
                        displaySearchResults(results);
                    } else {
                        const activeTab = document.querySelector('.icon-tab.active');
                        if (activeTab) {
                            window.iconPicker.renderCategory(activeTab.dataset.category);
                        }
                    }
                }, 300);
            });
        }
        
        function displaySearchResults(results) {
            const container = document.getElementById('iconPickerGrid');
            if (!container) return;
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="icon-picker-empty">
                        <div class="icon-picker-empty-icon">üîç</div>
                        <div class="icon-picker-empty-text">Keine Icons gefunden</div>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = results.map(item => `
                <div class="icon-item ${window.iconPicker.selectedIcon === item.icon ? 'selected' : ''}" 
                     data-icon="${item.icon}"
                     title="${item.name}${item.category ? ' (' + item.category + ')' : ''}">
                    <span class="icon-display">${item.icon}</span>
                    <span class="icon-name">${item.name}</span>
                </div>
            `).join('');
            
            container.querySelectorAll('.icon-item').forEach(item => {
                item.addEventListener('click', () => {
                    window.iconPicker.select(item.dataset.icon);
                });
            });
        }
    }
    
    // =========================================================================
    // FOTO UPLOAD PREVIEW
    // =========================================================================
    const itemPhoto = document.getElementById('itemPhoto');
    const photoPreview = document.getElementById('photoPreview');
    
    if (itemPhoto && photoPreview) {
        itemPhoto.addEventListener('change', function(e) {
            photoPreview.innerHTML = '';
            const file = e.target.files[0];
            
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    img.style.maxWidth = '100%';
                    img.style.maxHeight = '200px';
                    img.style.borderRadius = '8px';
                    photoPreview.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        });
    }
    
    const quickPhoto = document.getElementById('quickPhoto');
    const quickPhotoPreview = document.getElementById('quickPhotoPreview');
    
    if (quickPhoto && quickPhotoPreview) {
        quickPhoto.addEventListener('change', function(e) {
            quickPhotoPreview.innerHTML = '';
            const file = e.target.files[0];
            
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = document.createElement('img');
                    img.src = event.target.result;
                    img.style.maxWidth = '100%';
                    img.style.maxHeight = '200px';
                    img.style.borderRadius = '8px';
                    quickPhotoPreview.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        });
    }
    
    console.log('‚úÖ ef-sin Inventur v2.0.4 - Initialization complete!');
});
</script>

</body>
                    </html>
